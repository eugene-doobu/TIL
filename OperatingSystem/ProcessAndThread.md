# 프로세스와 스레드

- 프로세스: 프로그램 메모리 상에서 실행중인 작업
- 스레드: 프로세스 안에서 실행되는 여러 흐름 단위

기본적으로 프로세스마다 최소 1개의 스레드 소유(메인 스레드 포함)

## 메모리 영역

- Code: 코드 자체를 구성하는 메모리 영역(프로그램 명령)
- Data: 전역변수, 정적변수, 배열 등<br>data: 초기화 된 데이터가 저장되는 영역<br>bss: 초기화 되지 않은 데이터가 저장되는 영역
- Heap: 동적 할당 시 사용
- Stack: 지역변수, 매개변수, 리턴 값 등 임시 메모리 영역

![스레드데이터영역](./img/ThreadData.png)

(연두색: Heap, Data, 파란색: thread, 노란색: stack)

스레드는 Stack만 따로 할당 받고 나머지 영역은 서로 공유

하나의 프로세스가 생성될 때, 기본적으로 하나의 스레드가 같이 생성됨

프로세스는 자신만의 고유 공간과 자원을 할당받아 사용하는데 반해, 스레드는 다른 스레드와 공간, 자원을 공유하면서 사용하는 차이가 존쟇마

## 멀티프로세스

하나의 컴퓨터에 여러 CPU 장착 -> 하나 이상의 프로세스들을 병렬로 동시에 처리

장점: 안정성(메모리 침범 문제를 OS차원에서 해결)

단점: 각각 독립된 메모리 영역을 갖고 있어, 작업량 많을 수록 오버헤드 발생. Context Switching으로 인한 성능 저하

### Context Switching

프로세스의 상태 정보를 저장하고 복원하는 일련의 과정

동작중인 프로세스가 대기하면서 해당 프로세스의 상태를 보관하고, 대기하고 있던 다음 순번의 프로세스가 동작하면서 이전에 보관했던 프로세스 상태를 복구하는 과정

프로세스는 각 독립된 메모리 영역을 할당받아 사용되므로, 캐시 메모리 초기화와 같은 무거운 작업이 진행되었을 때 오버헤드가 발생할 문제가 존재함

## 멀티 스레드

하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것

스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해줌

스레드의 context switch는 프로세스의 context switch와는 달리 캐시 메모리를 비울 필요가 없기 때문에 더 빠르다.(레지스터의 내용을 싸그리 날리고 다시 담아야 한다.)

이런 장점 때문에 여러 프로세스로 할 수 있는 작업들을 하나의 프로세스에서 스레드로 나눠 수행하는 것이다.

장점: 독립적인 프로세스에 비해 공유 메모리만큼의 시간, 자원 손실이 감소. 전역 변수와 정적 변수에 대한 자료 공유 가능

단점: 안정성 문제. 하나의 스레드가 데이터 공간 망가뜨리면, 모든 스레드가 작동 불능 상태(공유 메모리를 갖기 때문)

멀티스레드의 안정성에 대한 단점은 Critical Section 기법을 통해 대비

## 멀티 스레드 vs 멀티 프로세스

멀티 스레드는 더 적은 메모리 공간을 차지하고 context switch가 빠른 장점이 있다. 하지만 오류로 인해 하나의 스레드가 종료되면 전체 스레드가 종료될 수 있다는 점과 동기화 문제를 가지고 있다.

멀티 프로세스는 하나의 프로세스가 죽더라도 다른 프로세스에는 영향을 끼치지 않고 정상적으로 수행되지만, 더 많은 메모리 공간과 CPU 시간을 차지한다는 단점이 있다.

## 기타

기아현상: 코어의 힘을 잘 받 지 못하는 스레드
