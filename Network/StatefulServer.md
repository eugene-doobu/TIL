# Stateful Server

실시간 온라인 게임에 사용되는 대표적인 기술로 수천, 수만명의 유저가 실시간으로 같은 화면을 바라보며 동적인 플레이를 지원해주는 서버

대표게임: 오버워치, 롤 등

P2P와 C/S구조가 있으며, 최근에는 C/S 구조의 방식을 많이 사용하는 편

### 장점

1. 연결 유지로 인해 다른 유저들의 행동, 변화를 바로바로 동기화 가능
1. 빠른 처리속도로 실시간 온라인 게임 설계 가능
1. 모든 게임의 로직을 서버가 전담하므로 핵이 불가능

### 단점

1. 개발 자체가 어려움
1. 서버가 다운되면 모든 유저의 게임이 종료되며, 롤백 가능성이 있음
1. MMORPG같은 경우 한 서버당 접속자 제한이 생김(서버군, 채널로 분산)

## 연결유지

TCP 또는 UDP를 이용한 클라이언트와 서버의 연결이 유지되고 있다.

연결이 유지되어야 모든 유저들에게 실시간으로 데이터를 전송시켜 줄 수 있다.

서버와 클라이언트는 항시 연결을 유지하고 있기 때문에 클라이언트 -> 서버, 서버 -> 클라이언트 의 상호간 실시간 통신이 가능하다.

## 서버의 메모리

접속한 유저들이 모든 게임 컨텐츠 데이터를 게임 서버 메모리에 보관하며, 실시간으로 로직을 처리한다.

서버 주도로 이동, 공격 등 모든 컨텐츠가 처리되어야 한다. 게임로직의 빠른 처리를 위해서는 서버 컴퓨터의 메모리에 현재 플레이 중인 모든 유저의 컨텐츠 데이터를 보관하여 처리 하도록 해야한다.

이것이 Stateful 서버의 주 기능으로, 서버가 자체적으로 데이터(상태)를 유지한다.

(물론 그래픽, 사운드와 관련된 데이터는 서버가 보관하지 않는다)

## 프로그래밍 언어

빠른 처리가 필수적이기 때문에 C/C++을 많이 사용하며 최근 C# 등의 언어도 사용되고 있다.

## 데이터베이스

Stateful 게임서버의 모든 로직은 서버의 메모리의 자료를 기반으로 처리하기 때문에 DB의 활용도가 다소 떨어짐.

보통 DB에서 플레이어의 초기값을 읽어오고, 중간중간 굵직한 데이터를 저장하는데 DB를 활용함

게임서버의 메모리: 현재 플레이중인 게임 로직 처리의 기준. 실제 최신 데이터

데이터베이스의 데이터: 메모리에서 처리된 데이터의 보관, 서버OFF시 보관을 위한 데이터

이때문에 DB에 데이터가 저장되기 전에 게임서버가 다운되면 마지막에 저장되지 못한 일부 데이터가 유실되어 없어지는 것

## 확장, 분산 방식

서버의 확장 방법에는 Scale-Out과 Scale-Up이 있다.

Scale-Out: 수평적 확장, 서버의 대수를 늘려 더 많은 사용자를 받도록 함
Scale-Up: 수직적 확장, 